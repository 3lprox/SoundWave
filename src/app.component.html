<div class="relative min-h-screen text-gray-200 font-sans antialiased pb-28">
  <audio #audioPlayer (timeupdate)="onTimeUpdate($event)" (ended)="onEnded()"></audio>

  <!-- Main Content -->
  <main class="p-4 sm:p-6 md:p-8">
    <header class="flex justify-between items-center mb-6">
      <div class="flex items-center space-x-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-orange-400" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z" clip-rule="evenodd" />
        </svg>
        <h1 class="text-2xl sm:text-3xl font-bold tracking-tight text-white">SoundWave AI</h1>
      </div>
      <button (click)="isUploading.set(true)" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200 flex items-center space-x-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd" />
        </svg>
        <span>Upload</span>
      </button>
    </header>

    <!-- Playlist -->
    <h2 class="text-xl font-semibold text-gray-300 mb-4">Your Playlist</h2>
    <div class="space-y-2">
      @for (track of playlist(); track track.id; let i = $index) {
        <div 
          (click)="selectTrack(track)"
          class="flex items-center p-3 rounded-lg cursor-pointer transition-all duration-200"
          [class]="currentTrack()?.id === track.id ? 'bg-zinc-700' : 'hover:bg-zinc-800'">
          <span class="text-gray-400 w-8 text-center">{{ i + 1 }}</span>
          <img [src]="track.coverArt" alt="Cover Art" class="w-12 h-12 rounded-md object-cover mr-4" />
          <div class="flex-grow">
            <p class="font-semibold text-white">{{ track.title }}</p>
            <p class="text-sm text-gray-400">{{ track.artist }}</p>
          </div>
          @if (currentTrack()?.id === track.id) {
            <div class="text-orange-400">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 animate-pulse" viewBox="0 0 20 20" fill="currentColor">
                <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a1 1 0 011-1h14a1 1 0 110 2H3a1 1 0 01-1-1z" />
              </svg>
            </div>
          }
        </div>
      } @empty {
        <div class="text-center py-10 px-4 rounded-lg bg-zinc-800">
          <p class="text-gray-400">Your playlist is empty.</p>
          <p class="text-gray-500 text-sm mt-1">Click 'Upload' to add your first track!</p>
        </div>
      }
    </div>
  </main>

  <!-- Player Bar -->
  @if (currentTrack(); as track) {
    <div class="fixed bottom-0 left-0 right-0 bg-zinc-800/80 backdrop-blur-md border-t border-zinc-700 p-3 shadow-lg">
      <div class="flex items-center space-x-4 max-w-6xl mx-auto">
        <!-- Track Info -->
        <div class="flex items-center space-x-3 w-1/4">
          <img [src]="track.coverArt" alt="Cover Art" class="w-14 h-14 rounded-md object-cover" />
          <div>
            <p class="font-bold text-white truncate">{{ track.title }}</p>
            <p class="text-sm text-gray-400 truncate">{{ track.artist }}</p>
          </div>
        </div>
        <!-- Player Controls -->
        <div class="flex-grow flex flex-col items-center justify-center space-y-1 w-1/2">
          <div class="flex items-center space-x-4 text-white">
            <button (click)="prevTrack()" class="p-1 text-gray-400 hover:text-white transition-colors">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M8.445 14.832A1 1 0 0010 14.126V5.874a1 1 0 00-1.555-.832L4.22 8.528a1 1 0 000 1.664l4.225 3.64zM11.555 4.168A1 1 0 0113 5.874v8.252a1 1 0 01-1.445.894l-4.225-3.64a1 1 0 010-1.788l4.225-3.64z"/></svg>
            </button>
            <button (click)="togglePlay()" class="w-12 h-12 flex items-center justify-center bg-white text-zinc-900 rounded-full hover:scale-105 transition-transform">
              @if(!isPlaying()){
                <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20"><path d="M6.79 5.485a1 1 0 011.41 0l4.242 4.243a1 1 0 010 1.414l-4.242 4.243a1 1 0 01-1.41-1.414L10.086 12 6.79 8.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
              } @else {
                <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20"><path d="M6.25 5C5.56 5 5 5.56 5 6.25v7.5c0 .69.56 1.25 1.25 1.25h1.5c.69 0 1.25-.56 1.25-1.25v-7.5C9 5.56 8.44 5 7.75 5h-1.5zM12.25 5c-.69 0-1.25.56-1.25 1.25v7.5c0 .69.56 1.25 1.25 1.25h1.5c.69 0 1.25-.56 1.25-1.25v-7.5c0-.69-.56-1.25-1.25-1.25h-1.5z"/></svg>
              }
            </button>
            <button (click)="nextTrack()" class="p-1 text-gray-400 hover:text-white transition-colors">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M11.555 5.168A1 1 0 0010 5.874v8.252a1 1 0 001.555.894l4.225-3.64a1 1 0 000-1.788l-4.225-3.64zM4.555 4.168A1 1 0 016 5.874v8.252a1 1 0 01-1.445.894L.33 8.764a1 1 0 010-1.788l4.225-3.64z"/></svg>
            </button>
          </div>
          <!-- Progress Bar -->
          <div class="w-full flex items-center space-x-2">
            <span class="text-xs text-gray-400">{{ formatTime(currentTime()) }}</span>
            <div class="flex-grow bg-zinc-600 rounded-full h-1.5 cursor-pointer" (click)="seek($event)">
              <div class="bg-orange-400 h-1.5 rounded-full" [style.width.%]="(currentTime() / duration()) * 100"></div>
            </div>
            <span class="text-xs text-gray-400">{{ formatTime(duration()) }}</span>
          </div>
        </div>
        <!-- Volume Control -->
        <div class="flex items-center space-x-2 w-1/4 justify-end">
           <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
              <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a1 1 0 011-1h14a1 1 0 110 2H3a1 1 0 01-1-1z" />
            </svg>
          <input type="range" min="0" max="1" step="0.01" [value]="volume()" (input)="setVolume($event)" class="w-24">
        </div>
      </div>
    </div>
  }

  <!-- Upload Modal -->
  @if (isUploading()) {
    <div class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4" (click)="cancelUpload()">
      <div class="bg-zinc-8